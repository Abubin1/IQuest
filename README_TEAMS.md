# Функциональность команд в IQuest

## Обзор изменений

Была реализована улучшенная система управления командами, которая позволяет:

1. **Создавать команды заранее** - пользователи могут создавать команды без привязки к конкретному мероприятию
2. **Централизованное управление** - вкладка "Группы" теперь показывает все команды пользователя и приглашения
3. **Гибкая регистрация** - при регистрации на мероприятие можно выбрать существующую команду или создать новую

## Новые экраны

### 1. TeamsActivity (Главный экран команд)
- **Расположение**: Вкладка "Группы" в нижней навигации
- **Функции**:
  - Просмотр текущих команд пользователя
  - Просмотр и управление приглашениями
  - Создание новых команд
  - Переход к детальному управлению командой

### 2. CreateTeamActivity (Создание команды)
- **Доступ**: Кнопка "Создать новую команду" в TeamsActivity
- **Функции**:
  - Ввод названия команды
  - Создание команды с привязкой или без привязки к мероприятию

### 3. SelectTeamActivity (Выбор команды)
- **Доступ**: При регистрации на мероприятие, выбор "Присоединиться к существующей команде"
- **Функции**:
  - Просмотр доступных команд
  - Выбор команды для участия в мероприятии
  - Создание новой команды для мероприятия

## Обновленная логика регистрации

### Старая логика:
1. Пользователь нажимает "Зарегистрироваться"
2. Создается новая команда для мероприятия
3. Переход к управлению командой

### Новая логика:
1. Пользователь нажимает "Зарегистрироваться"
2. Выбор действия:
   - **Создать новую команду** → CreateTeamActivity
   - **Присоединиться к существующей команде** → SelectTeamActivity
3. Переход к управлению командой

## API изменения

### Обновленные эндпоинты:

1. **POST /api/teams**
   - Теперь поддерживает `eventId: null` для создания общих команд
   - Проверка на существующую команду только при указании eventId

2. **GET /api/my-team**
   - Поддерживает запрос без eventId для получения любой команды пользователя
   - При указании eventId возвращает команду для конкретного мероприятия

3. **GET /api/invites**
   - Поддерживает запрос без eventId для получения всех приглашений
   - При указании eventId фильтрует приглашения по мероприятию

## База данных

### Обновления таблиц:

1. **Команды**
   - Поле "Мероприятие" может быть NULL
   - Добавлены индексы для улучшения производительности

2. **Приглашения**
   - Добавлено уникальное ограничение для предотвращения дублирования
   - Добавлены индексы

## Файлы для выполнения

1. **SQL скрипт**: `Server/update_teams_table.sql`
   - Выполнить в PostgreSQL для обновления структуры БД

2. **Сервер**: `Server/server.js`
   - Обновлен для поддержки новой логики

3. **Android приложение**:
   - Новые активности в `app/src/main/java/com/proj/quest/ui/main/`
   - Обновленные layouts в `app/src/main/res/layout/`
   - Обновленный AndroidManifest.xml

## Использование

### Для пользователей:

1. **Создание команды**:
   - Перейти во вкладку "Группы"
   - Нажать "Создать новую команду"
   - Ввести название команды

2. **Регистрация на мероприятие**:
   - Открыть мероприятие
   - Нажать "Зарегистрироваться"
   - Выбрать способ участия

3. **Управление командой**:
   - Во вкладке "Группы" нажать на команду
   - Приглашать участников
   - Управлять составом

### Для разработчиков:

1. Выполнить SQL скрипт в базе данных
2. Обновить сервер
3. Пересобрать Android приложение

## Планы развития

1. **Привязка команды к мероприятию** - API для привязки существующей команды к мероприятию
2. **Множественные команды** - поддержка участия в нескольких командах
3. **История команд** - просмотр прошлых команд и результатов
4. **Уведомления** - push-уведомления о приглашениях и изменениях в команде 